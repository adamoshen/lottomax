---
title: "Cleaning LottoMax data"
author: "Adam Shen"
date: "June 22, 2021"
output:
  html_document:
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
    highlight: tango
    theme:
      bootswatch: cosmo
      base_font:
        google: "IBM Plex Sans"
      code_font:
        google: "IBM Plex Mono"
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
```

# Packages

```{r}
library(tidyverse)
library(lubridate)
```

# Load the data

```{r}
lottomax <- readRDS("./data/lottomax.RDS")

lottomax

as.character(lottomax[1,2])

as.character(lottomax[1,3])
```

# Clean the data

To do:

- `date`: remove the non-space characters and the "With Max Millions!" phrase
- Need to filter to only include dates after May 14, 2019 (inclusive) since LottoMax
was changed to now have 50 possible numbers instead of 49
- `result`: remove the non-space characters and reformat this column somehow so
that the numbers are a easy to access and manipulate
- Remember that the last number is a "bonus" number
- Preferable to sort data too

A wide and long version of the data set will likely be useful.

- Wide version for analysis of "number positions"
- Long version for regular numerical summaries

## Wide version

```{r}
lottomax_wide <- lottomax %>%
  # Convert `year` to factor
  mutate(across(year, as.factor)) %>%
  # Repair `date` to be an actual date
  mutate(
    # Remove excessive whitespace from `date` column
    date = str_squish(date),
    # Remove extra text
    date = str_remove(date, pattern="With Max Millions!"),
    # Parse date text in mm/dd/yyyy format
    date = mdy(date)
  ) %>%
  # Keep only rows that were drawn after May 14, 2019 (inclusive)
  filter(date >= mdy("May 14 2019")) %>%
  # Remove excessive whitespace from `result` column
  mutate(result = str_squish(result)) %>%
  # Separate all numbers into their own columns
  # Set `remove=FALSE` to check if we did it correctly
  separate(result, into=c(glue::glue("num{1:7}"), "bonus"), sep=" ", remove=FALSE) %>%
  # Conversion of strings to numbers that we can work with
  mutate(across(c(num1:num7, bonus), parse_integer)) %>%
  arrange(date)

lottomax_wide
```

```{r, eval=FALSE}
saveRDS(lottomax_wide, "./data/lottomax_wide.RDS", version=2)
```

## Long version

```{r}
lottomax_long <- lottomax_wide %>%
  pivot_longer(
    cols = c(num1:num7, bonus),
    names_to = "role",
    values_to = "number"
  )

lottomax_long
```

```{r, eval=FALSE}
saveRDS(lottomax_long, "./data/lottomax_long.RDS", version=2)
```


# Session info

```{r, echo=FALSE}
sessioninfo::package_info(
  pkgs = c("tibble", "dplyr", "stringr", "tidyr", "glue", "lubridate",
           "bslib", "rmarkdown"),
  dependencies = FALSE
)
```


```{r, eval=FALSE, include=FALSE}
rmarkdown::render("02-clean.Rmd", output_dir="./output")
```
