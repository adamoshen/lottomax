<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Cleaning the data | LottoMax</title>
  <meta name="description" content="2 Cleaning the data | LottoMax" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Cleaning the data | LottoMax" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Cleaning the data | LottoMax" />
  
  
  

<meta name="author" content="Adam Shen" />


<meta name="date" content="2021-08-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="obtaining-the-data.html"/>
<link rel="next" href="numerical-and-graphical-summaries.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="utils/prismr.js"></script>




<link rel="stylesheet" href="css/gitbook.css" type="text/css" />
<link rel="stylesheet" href="css/adam-light.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#session-info"><i class="fa fa-check"></i>Session info</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="obtaining-the-data.html"><a href="obtaining-the-data.html"><i class="fa fa-check"></i><b>1</b> Obtaining the data</a>
<ul>
<li class="chapter" data-level="1.1" data-path="obtaining-the-data.html"><a href="obtaining-the-data.html#packages"><i class="fa fa-check"></i><b>1.1</b> Packages</a></li>
<li class="chapter" data-level="1.2" data-path="obtaining-the-data.html"><a href="obtaining-the-data.html#create-function-to-get-data-for-each-year"><i class="fa fa-check"></i><b>1.2</b> Create function to get data for each year</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="obtaining-the-data.html"><a href="obtaining-the-data.html#try-2021"><i class="fa fa-check"></i><b>1.2.1</b> Try 2021</a></li>
<li class="chapter" data-level="1.2.2" data-path="obtaining-the-data.html"><a href="obtaining-the-data.html#general-case"><i class="fa fa-check"></i><b>1.2.2</b> General case</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="obtaining-the-data.html"><a href="obtaining-the-data.html#get-the-data"><i class="fa fa-check"></i><b>1.3</b> Get the data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cleaning-the-data.html"><a href="cleaning-the-data.html"><i class="fa fa-check"></i><b>2</b> Cleaning the data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cleaning-the-data.html"><a href="cleaning-the-data.html#packages-1"><i class="fa fa-check"></i><b>2.1</b> Packages</a></li>
<li class="chapter" data-level="2.2" data-path="cleaning-the-data.html"><a href="cleaning-the-data.html#load-the-data"><i class="fa fa-check"></i><b>2.2</b> Load the data</a></li>
<li class="chapter" data-level="2.3" data-path="cleaning-the-data.html"><a href="cleaning-the-data.html#clean-the-data"><i class="fa fa-check"></i><b>2.3</b> Clean the data</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="cleaning-the-data.html"><a href="cleaning-the-data.html#wide-version"><i class="fa fa-check"></i><b>2.3.1</b> Wide version</a></li>
<li class="chapter" data-level="2.3.2" data-path="cleaning-the-data.html"><a href="cleaning-the-data.html#long-version"><i class="fa fa-check"></i><b>2.3.2</b> Long version</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="numerical-and-graphical-summaries.html"><a href="numerical-and-graphical-summaries.html"><i class="fa fa-check"></i><b>3</b> Numerical and graphical summaries</a>
<ul>
<li class="chapter" data-level="3.1" data-path="numerical-and-graphical-summaries.html"><a href="numerical-and-graphical-summaries.html#packages-2"><i class="fa fa-check"></i><b>3.1</b> Packages</a></li>
<li class="chapter" data-level="3.2" data-path="numerical-and-graphical-summaries.html"><a href="numerical-and-graphical-summaries.html#load-the-data-1"><i class="fa fa-check"></i><b>3.2</b> Load the data</a></li>
<li class="chapter" data-level="3.3" data-path="numerical-and-graphical-summaries.html"><a href="numerical-and-graphical-summaries.html#plan"><i class="fa fa-check"></i><b>3.3</b> Plan</a></li>
<li class="chapter" data-level="3.4" data-path="numerical-and-graphical-summaries.html"><a href="numerical-and-graphical-summaries.html#wide-data"><i class="fa fa-check"></i><b>3.4</b> Wide data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="numerical-and-graphical-summaries.html"><a href="numerical-and-graphical-summaries.html#most-frequent-minimums-and-maximums---overall"><i class="fa fa-check"></i><b>3.4.1</b> Most frequent minimums and maximums - overall</a></li>
<li class="chapter" data-level="3.4.2" data-path="numerical-and-graphical-summaries.html"><a href="numerical-and-graphical-summaries.html#which-numbers-have-never-been-in-the-minimummaximums"><i class="fa fa-check"></i><b>3.4.2</b> Which numbers have NEVER been in the minimum/maximums?</a></li>
<li class="chapter" data-level="3.4.3" data-path="numerical-and-graphical-summaries.html"><a href="numerical-and-graphical-summaries.html#most-frequent-minimum-and-maximum---by-year"><i class="fa fa-check"></i><b>3.4.3</b> Most frequent minimum and maximum - by year</a></li>
<li class="chapter" data-level="3.4.4" data-path="numerical-and-graphical-summaries.html"><a href="numerical-and-graphical-summaries.html#summary-statistics-for-minimum-and-maximum"><i class="fa fa-check"></i><b>3.4.4</b> Summary statistics for minimum and maximum</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">LottoMax</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning-the-data" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Cleaning the data</h1>
<div id="packages-1" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Packages</h2>
<pre class="r language-r"><code>library(tidyverse)
library(lubridate)</code></pre>
</div>
<div id="load-the-data" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Load the data</h2>
<pre class="r language-r"><code>lottomax &lt;- readRDS(&quot;./data/lottomax.RDS&quot;)

lottomax</code></pre>
<pre class="language-r"><code>## # A tibble: 249 x 4
##    year  Date                  `Draw Results`              Jackpot              
##    &lt;chr&gt; &lt;chr&gt;                 &lt;chr&gt;                       &lt;chr&gt;                
##  1 2019  &quot;December 31 2019\r\~ &quot;3\r\n\t\t\t\t\t\t\r\n\t\t~ &quot;$65,000,000&quot;        
##  2 2019  &quot;December 27 2019\r\~ &quot;13\r\n\t\t\t\t\t\t\r\n\t\~ &quot;$60,000,000&quot;        
##  3 2019  &quot;December 24 2019\r\~ &quot;1\r\n\t\t\t\t\t\t\r\n\t\t~ &quot;$55,000,000&quot;        
##  4 2019  &quot;December 20 2019\r\~ &quot;14\r\n\t\t\t\t\t\t\r\n\t\~ &quot;$50,000,000&quot;        
##  5 2019  &quot;Next Lotto Max Jack~ &quot;Next Lotto Max Jackpot\r\~ &quot;Next Lotto Max Jack~
##  6 2019  &quot;December 17 2019&quot;    &quot;19\r\n\t\t\t\t\t\t\r\n\t\~ &quot;$40,000,000&quot;        
##  7 2019  &quot;December 13 2019&quot;    &quot;2\r\n\t\t\t\t\t\t\r\n\t\t~ &quot;$31,000,000&quot;        
##  8 2019  &quot;December 10 2019&quot;    &quot;7\r\n\t\t\t\t\t\t\r\n\t\t~ &quot;$26,000,000&quot;        
##  9 2019  &quot;December 6 2019&quot;     &quot;9\r\n\t\t\t\t\t\t\r\n\t\t~ &quot;$21,000,000&quot;        
## 10 2019  &quot;December 3 2019&quot;     &quot;2\r\n\t\t\t\t\t\t\r\n\t\t~ &quot;$16,000,000&quot;        
## # ... with 239 more rows</code></pre>
<pre class="r language-r"><code>as.character(lottomax[1,2])</code></pre>
<pre class="language-r"><code>## [1] &quot;December 31 2019\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tWith Max Millions!&quot;</code></pre>
<pre class="r language-r"><code>as.character(lottomax[1,3])</code></pre>
<pre class="language-r"><code>## [1] &quot;3\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t4\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t11\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t19\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t30\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t39\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t40\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t25&quot;</code></pre>
</div>
<div id="clean-the-data" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Clean the data</h2>
<p>To do:</p>
<ul>
<li><p>Rename (shorten) <code>Date</code> and <code>Draw Results</code> columns using <code>tidyselect::contains</code> since column
names were recently updated to something similar but not the same. I.e. don't use a fixed old_name
in <code>new_name = old_name</code> convention</p></li>
<li><p>Remove <code>Jackpot</code> column</p></li>
<li><p>Remove rows mentioning "Next Lotto Max Jackpot ...". This needs to be done before parsing dates</p></li>
<li><p><code>date</code>: remove the non-space characters and the "With Max Millions!" phrase</p></li>
<li><p>Need to filter to only include dates after May 14, 2019 (inclusive) since LottoMax
was changed to now have 50 possible numbers instead of 49</p></li>
<li><p><code>result</code>: remove the non-space characters and reformat this column so that the numbers
are easy to access and manipulate</p></li>
<li><p>Remember that the last number is a "bonus" number</p></li>
<li><p>Preferable to sort data too</p></li>
</ul>
<pre class="r language-r"><code>lottomax_clean &lt;- lottomax %&gt;%
  rename(&quot;date&quot; = contains(&quot;date&quot;)) %&gt;%
  rename(&quot;result&quot; = contains(&quot;results&quot;)) %&gt;%
  # Convert `year` to factor
  mutate(across(year, as.factor)) %&gt;%
  # Keep rows that *don&#39;t* contain &quot;Next Lotto Max Jackpot&quot;
  filter(str_detect(date, pattern=&quot;Next&quot;, negate=TRUE)) %&gt;%
  # Repair `date` to be an actual date
  mutate(
    # Remove excessive whitespace from `date` column
    date = str_squish(date),
    # Remove extra text
    date = str_remove(date, pattern=&quot;With Max Millions!&quot;),
    # Parse date text in mm/dd/yyyy format
    date = mdy(date)
  ) %&gt;%
  # Keep only rows that were drawn after May 14, 2019 (inclusive)
  filter(date &gt;= mdy(&quot;May 14 2019&quot;)) %&gt;%
  # Remove excessive whitespace from `result` column
  mutate(result = str_squish(result)) %&gt;%
  select(year, date, result) %&gt;%
  arrange(date)

lottomax_clean</code></pre>
<pre class="language-r"><code>## # A tibble: 227 x 3
##    year  date       result                 
##    &lt;fct&gt; &lt;date&gt;     &lt;chr&gt;                  
##  1 2019  2019-05-14 9 24 27 33 40 44 48 41 
##  2 2019  2019-05-17 4 21 23 39 40 42 50 17 
##  3 2019  2019-05-21 2 3 8 18 31 39 50 33   
##  4 2019  2019-05-24 9 11 15 19 20 35 41 28 
##  5 2019  2019-05-28 4 9 10 26 27 29 37 14  
##  6 2019  2019-05-31 6 29 34 39 42 47 50 22 
##  7 2019  2019-06-04 7 19 22 28 34 41 42 12 
##  8 2019  2019-06-07 4 8 13 23 25 33 39 17  
##  9 2019  2019-06-11 18 23 28 32 34 44 50 29
## 10 2019  2019-06-14 4 11 20 22 37 44 49 13 
## # ... with 217 more rows</code></pre>
<p>A wide and long version of the data set will likely be useful.</p>
<ul>
<li>Wide version for analysis of "number positions"</li>
<li>Long version for regular numerical summaries</li>
</ul>
<div id="wide-version" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Wide version</h3>
<pre class="r language-r"><code>lottomax_wide &lt;- lottomax_clean %&gt;%
  # Separate all numbers into their own columns
  # Set `remove=FALSE` to check if we did it correctly
  separate(result, into=c(glue::glue(&quot;num{1:7}&quot;), &quot;bonus&quot;), sep=&quot; &quot;, remove=FALSE) %&gt;%
  # Conversion of strings to numbers that we can work with
  mutate(across(c(num1:num7, bonus), parse_integer)) 

lottomax_wide</code></pre>
<pre class="language-r"><code>## # A tibble: 227 x 11
##    year  date       result        num1  num2  num3  num4  num5  num6  num7 bonus
##    &lt;fct&gt; &lt;date&gt;     &lt;chr&gt;        &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1 2019  2019-05-14 9 24 27 33 ~     9    24    27    33    40    44    48    41
##  2 2019  2019-05-17 4 21 23 39 ~     4    21    23    39    40    42    50    17
##  3 2019  2019-05-21 2 3 8 18 31~     2     3     8    18    31    39    50    33
##  4 2019  2019-05-24 9 11 15 19 ~     9    11    15    19    20    35    41    28
##  5 2019  2019-05-28 4 9 10 26 2~     4     9    10    26    27    29    37    14
##  6 2019  2019-05-31 6 29 34 39 ~     6    29    34    39    42    47    50    22
##  7 2019  2019-06-04 7 19 22 28 ~     7    19    22    28    34    41    42    12
##  8 2019  2019-06-07 4 8 13 23 2~     4     8    13    23    25    33    39    17
##  9 2019  2019-06-11 18 23 28 32~    18    23    28    32    34    44    50    29
## 10 2019  2019-06-14 4 11 20 22 ~     4    11    20    22    37    44    49    13
## # ... with 217 more rows</code></pre>
<pre class="r language-r"><code>saveRDS(lottomax_wide, &quot;./data/lottomax_wide.RDS&quot;, version=2)</code></pre>
</div>
<div id="long-version" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Long version</h3>
<pre class="r language-r"><code>lottomax_long &lt;- lottomax_wide %&gt;%
  pivot_longer(
    cols = c(num1:num7, bonus),
    names_to = &quot;role&quot;,
    values_to = &quot;number&quot;
  )

lottomax_long</code></pre>
<pre class="language-r"><code>## # A tibble: 1,816 x 5
##    year  date       result                 role  number
##    &lt;fct&gt; &lt;date&gt;     &lt;chr&gt;                  &lt;chr&gt;  &lt;int&gt;
##  1 2019  2019-05-14 9 24 27 33 40 44 48 41 num1       9
##  2 2019  2019-05-14 9 24 27 33 40 44 48 41 num2      24
##  3 2019  2019-05-14 9 24 27 33 40 44 48 41 num3      27
##  4 2019  2019-05-14 9 24 27 33 40 44 48 41 num4      33
##  5 2019  2019-05-14 9 24 27 33 40 44 48 41 num5      40
##  6 2019  2019-05-14 9 24 27 33 40 44 48 41 num6      44
##  7 2019  2019-05-14 9 24 27 33 40 44 48 41 num7      48
##  8 2019  2019-05-14 9 24 27 33 40 44 48 41 bonus     41
##  9 2019  2019-05-17 4 21 23 39 40 42 50 17 num1       4
## 10 2019  2019-05-17 4 21 23 39 40 42 50 17 num2      21
## # ... with 1,806 more rows</code></pre>
<pre class="r language-r"><code>saveRDS(lottomax_long, &quot;./data/lottomax_long.RDS&quot;, version=2)</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="obtaining-the-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="numerical-and-graphical-summaries.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false,
"info": false
});
});
</script>

</body>

</html>
